{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"isomorphic-fetch\"","webpack:///external \"xml-js\"","webpack:///external \"util\"","webpack:///external \"puppeteer\"","webpack:///./saveLogs.ts","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///./processSiteMap.ts","webpack:///./crawler.ts","webpack:///./filterLinks.ts","webpack:///./app.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","logs","folder","resolve","__dirname","timeNow","Date","fileTitle","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","jsonData","JSON","stringify","writeFile","err","console","log","getUrls","elements","reduce","carry","current","length","locationElement","find","element","urlElement","type","url","text","push","data","xml2js","filter","concat","testPage","async","pageLogs","browser","launch","args","page","newPage","on","errorData","pageResponse","goto","waitUntil","waitFor","random","Math","toString","substring","screenshot","path","close","responseCode","status","urls","links","toFilter","link","pass","forEach","urlPart","indexOf","then","response","str","devLinks","map","replace","testLog","colors","depth","saveLogs"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,gBClFrDhC,EAAOD,QAAUkC,QAAQ,qB,cCAzBjC,EAAOD,QAAUkC,QAAQ,W,cCAzBjC,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,c,8BCAzB,gDAwBe,IAnBGC,IACd,MAAMC,EAAS,IAAKC,QAAQC,EAAW,WACjCC,EAAU,IAAIC,KACdC,EAAY,OAAOF,EAAQG,iBAC7BH,EAAQI,WAAa,KACrBJ,EAAQK,cAAcL,EAAQM,cAAcN,EAAQO,gBAAgBP,EAAQQ,eAC1EC,EAAWC,KAAKC,UAAUf,GAMhC,IAAGgB,UAAUf,EAAS,IAAMK,EAAY,QAASO,GAAU,SAAUI,GAC7DA,GACAC,QAAQC,IAAI,gCAAiCF,S,8BCnBzDnD,EAAOD,QAAUkC,QAAQ,S,cCAzBjC,EAAOD,QAAUkC,QAAQ,O,wECezB,MAiBMqB,EAAWC,GACbA,EAASC,OAAO,CAACC,EAAiBC,KAC9B,GAAqB,QAAjBA,EAAQlD,MAA8C,IAA5BkD,EAAQH,SAASI,OAC3C,OAGJ,MAAMC,EAAkBF,EAAQH,SAASM,KAAMC,GACnCA,EAAQtD,KAAO,OAG3B,IAAKoD,EACD,OAGJ,MAAMG,EAAaH,EAAgBL,SAASM,KAAMC,GACtB,SAAjBA,EAAQE,MAGnB,IAAKD,EACD,OAGJ,MAAME,EAAMF,EAAWG,KAIvB,OAFAT,EAAMU,KAAKF,GAEJR,GACR,IAEQ,MA9CSW,GAEH,IAAMC,OAAOD,GAELb,SAASe,OAAQR,GACd,WAAjBA,EAAQtD,MAIJgD,OAAO,CAACC,EAAiBC,KAChCA,EAAQH,SAASI,OAAS,IAC1BF,EAAQA,EAAMc,OAAOjB,EAAQI,EAAQH,YAElCE,GACR,I,uBCnBP,MAgBMe,EAAWC,MAAOR,IACpB,MAAMS,EAA+B,GAC/BC,QAAgB,IAAUC,OAAO,CACnCC,KAAM,CAAC,eAAgB,8BAErBC,QAAaH,EAAQI,UAE3BD,EAAKE,GAAG,QAAS7B,IACbuB,EAASP,KAAK,CACVH,KAAM,QACNiB,UAAW9B,IAEfC,QAAQC,IAAI,gBAAiBF,EAAKc,KAGtCa,EAAKE,GAAG,YAAa7B,IACjBuB,EAASP,KAAK,CACVH,KAAM,YACNiB,UAAW9B,IAEfC,QAAQC,IAAI,oBAAqBF,EAAKc,KAc1C,MAAMiB,QAAqBJ,EAAKK,KAAKlB,EAAK,CAAEmB,UAAW,eAEjDN,EAAKO,QAAQ,KACnB,MAAMC,EAASC,KAAKD,SACfE,SAAS,IACTC,UAAU,GAMf,aALMX,EAAKY,WAAW,CAClBC,KAAM,eAAiBL,EAAS,0BAE9BX,EAAQiB,QAEP,CACH3B,IAAKA,EACL4B,aAAcX,EAAaY,SAC3B5D,KAAMwC,IAIC,MApECD,MAAOsB,IACnB3C,QAAQC,IAAI,aAAc0C,GAC1B,MAAM7D,EAAO,GAEb,IAAK,IAAIjC,EAAI,EAAGA,EAAI8F,EAAKpC,OAAQ1D,IAAK,CAClC,MAAMgE,EAAM8B,EAAK9F,GACjBiC,EAAKiC,WAAWK,EAASP,IACzBb,QAAQC,IAAI,iBAAkBY,GAGlC,OAAO/B,G,OCUI,MAzBM8D,IACjB,MAAMC,EAAW,CACb,gCACA,yBACA,kDACA,sDACA,yCACA,4BACA,uEACA,kDAaJ,OAViBD,EAAM1B,OAAQ4B,IAC3B,IAAIC,GAAO,EAMX,OALAF,EAASG,QAASC,KACiB,IAA3BH,EAAKI,QAAQD,KACbF,GAAO,KAGRA,KChBf,WAKI,IAHI,iFAICI,KAAMC,GACIA,EAAStC,QAEnBqC,KAAME,IACH,MAAMT,EAAkB,EAAeS,GAGjCC,EAF0B,EAAYV,GAEHW,IAAKT,GAC1CA,EAAKU,QACD,kBACA,8DAIR,OAAO,EAAQF,KAElBH,KAAMM,IACHzD,QAAQC,IACJ,WACA,kBAAQwD,EAAS,CACbC,QAAQ,EACRC,MAAO,MAGf,OAAAC,EAAA,GAASH,MA9BrB","file":"crawlerApp.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","module.exports = require(\"isomorphic-fetch\");","module.exports = require(\"xml-js\");","module.exports = require(\"util\");","module.exports = require(\"puppeteer\");","// import rimraf from 'rimraf';\nimport path from 'path';\nimport fs from 'fs';\nimport InterfacePageResult from './types/interfacePageResult';\n\nconst saveLogs = (logs: InterfacePageResult[]) => {\n    const folder = path.resolve(__dirname, '../logs');\n    const timeNow = new Date();\n    const fileTitle = `log_${timeNow.getFullYear()}-${\n        timeNow.getMonth() + 1\n    }-${timeNow.getDate()}--${timeNow.getHours()}-${timeNow.getMinutes()}-${timeNow.getSeconds()}`;\n    const jsonData = JSON.stringify(logs);\n\n    /* rimraf(folder + '/!*', () => {\n        console.log('cleaned');\n    }) */\n\n    fs.writeFile(folder + '/' + fileTitle + '.json', jsonData, function (err) {\n        if (err) {\n            console.log('error while writing logs file', err);\n        }\n    });\n};\n\nexport default saveLogs;\n","module.exports = require(\"path\");","module.exports = require(\"fs\");","import xmlJS from 'xml-js';\n\ntype xmlJsElement = {\n    name?: string;\n    elements?: xmlJsElement[];\n    type?: string;\n    text?: string;\n};\n\n/**\n * Creates array of url pages to crawl from sitemap text given\n *\n * @param {string} data\n * @return {string[]}\n */\nconst processSiteMap = (data: string): string[] => {\n    // convert xml to js\n    const jsObject = xmlJS.xml2js(data);\n    // extract url related elements\n    const urlSets = jsObject.elements.filter((element: xmlJsElement) => {\n        return element.name === 'urlset';\n    });\n\n    // get array of url's\n    return urlSets.reduce((carry: string[], current: xmlJsElement) => {\n        if (current.elements.length > 0) {\n            carry = carry.concat(getUrls(current.elements));\n        }\n        return carry;\n    }, []);\n};\n\nconst getUrls = (elements: xmlJsElement[]): string[] =>\n    elements.reduce((carry: string[], current) => {\n        if (current.name !== 'url' || current.elements.length === 0) {\n            return;\n        }\n\n        const locationElement = current.elements.find((element) => {\n            return (element.name = 'loc');\n        });\n\n        if (!locationElement) {\n            return;\n        }\n\n        const urlElement = locationElement.elements.find((element) => {\n            return element.type === 'text';\n        });\n\n        if (!urlElement) {\n            return;\n        }\n\n        const url = urlElement.text;\n\n        carry.push(url);\n\n        return carry;\n    }, []);\n\nexport default processSiteMap;\n","// eslint-disable-next-line import/default\nimport puppeteer from 'puppeteer';\nimport { inspect } from 'util';\nimport InterfacePageLog from './types/interfacePageLog';\nimport InterfacePageResult from './types/interfacePageResult';\n\n/**\n * test urls with puppeteer\n * @param {string[]} urls\n */\nconst crawler = async (urls: string[]): Promise<InterfacePageResult[]> => {\n    console.log('urls array', urls);\n    const logs = [];\n\n    for (let i = 0; i < urls.length; i++) {\n        const url = urls[i];\n        logs.push(await testPage(url));\n        console.log('page processed', url);\n    }\n\n    return logs;\n};\n\n/**\n * @param {string} url\n */\nconst testPage = async (url: string): Promise<InterfacePageResult> => {\n    const pageLogs: InterfacePageLog[] = [];\n    const browser = await puppeteer.launch({\n        args: ['--no-sandbox', '--disable-setuid-sandbox'],\n    });\n    const page = await browser.newPage();\n\n    page.on('error', err => {\n        pageLogs.push({\n            type: 'error',\n            errorData: err,\n        });\n        console.log('page on error', err, url);\n    });\n\n    page.on('pageerror', err => {\n        pageLogs.push({\n            type: 'pageerror',\n            errorData: err,\n        });\n        console.log('page on pageerror', err, url);\n    });\n\n    /*page.on('console', msg => {\n        pageLogs.push({\n            type: 'console',\n            text: msg._text,\n            details: {\n                location: msg._location\n            }\n        });\n        // console.log('console msg', msg, url);\n    });*/\n\n    const pageResponse = await page.goto(url, { waitUntil: 'load' });\n    // wait 1m for browser js to execute\n    await page.waitFor(1000);\n    const random = Math.random()\n        .toString(36)\n        .substring(7);\n    await page.screenshot({\n        path: 'screenshots/' + random + '_screenshot.png',\n    });\n    await browser.close();\n\n    return {\n        url: url,\n        responseCode: pageResponse.status(),\n        logs: pageLogs,\n    };\n};\n\nexport default crawler;\n","/**\n * Filter urls we dont want to check\n * @param {string[]} links\n * @return {string[]}\n */\nconst filterLinks = (links: string[]): string[] => {\n    const toFilter = [\n        'uzitecne-odkazy/slovnik-pojmu',\n        '/osobni/volani/roaming',\n        '/o-vodafonu/ke-stazeni/osobni-a-firemni/archiv/',\n        '/o-vodafonu/o-spolecnosti/pro-media/tiskove-zpravy/',\n        '/podminky/podminky-doplnkovych-sluzeb/',\n        '/podminky/nabidky-a-akce/',\n        '/o-vodafonu/ke-stazeni/osobni-a-firemni/souteze-pravidla-a-podminky/',\n        '/about-vodafone/press-releases/message-detail/',\n    ];\n\n    const filtered = links.filter((link) => {\n        let pass = true;\n        toFilter.forEach((urlPart) => {\n            if (link.indexOf(urlPart) !== -1) {\n                pass = false;\n            }\n        });\n        return pass;\n    });\n\n    return filtered;\n};\n\nexport default filterLinks;\n","import fetch from 'isomorphic-fetch';\nimport processSiteMap from './processSiteMap';\nimport { inspect } from 'util';\nimport crawler from './crawler';\nimport saveLogs from './saveLogs';\nimport filterLinks from './filterLinks';\nimport InterfacePageResult from './types/interfacePageResult';\n\n(async () => {\n    const sitemapUrl =\n        'https://www.vodafone.cz/webs/vodafonecz/seo_data/sitemap-vodafonecz-final.xml';\n    // const sitemapUrl = 'http://localhost:5000/test-data.xml';\n\n    fetch(sitemapUrl)\n        .then((response) => {\n            return response.text();\n        })\n        .then((str) => {\n            const links: string[] = processSiteMap(str);\n            const filteredLinks: string[] = filterLinks(links);\n            // change hostname of target web to devservers\n            const devLinks: string[] = filteredLinks.map((link: string) =>\n                link.replace(\n                    'www.vodafone.cz',\n                    'vf-5058-assets-build-refactoring.vodafonecz.devbox.dev.cz',\n                ),\n            );\n            // const limitedAmount = devLinks.slice(0, 100);\n            return crawler(devLinks);\n        })\n        .then((testLog: InterfacePageResult[]) => {\n            console.log(\n                'test log',\n                inspect(testLog, {\n                    colors: true,\n                    depth: 10,\n                }),\n            );\n            saveLogs(testLog);\n        });\n})();\n"],"sourceRoot":""}